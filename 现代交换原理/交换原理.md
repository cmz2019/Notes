[toc]

# 一、交换概论

### 交换的概念

在通信领域中，所谓交换，就是在通信网上，负责在通信的源和目的终端之间建立通信信道传送通信信息的机制（控制）。  

### 通信网的组成

**三要素：**交换设备、传输设备、终端设备

![image-20210608101158836](https://gitee.com/cmz2000/album/raw/master/image/image-20210608101158836.png)

### 通信网三对基本概念

![image-20210608102220513](https://gitee.com/cmz2000/album/raw/master/image/image-20210608102220513.png)

### 交换系统基本结构

![image-20210608102333621](https://gitee.com/cmz2000/album/raw/master/image/image-20210608102333621.png)

### 电信交换系统的基本技术

+ **互连技术：**交换网络的拓扑结构、选路策略、控制机理、多播方式、阻塞特性、故障防卫  
+ **接口技术：**模拟用户接口、数字用户接口、模拟中继接口、数字中继接口  
+ **信令技术：**用户信令、局间信令  
+ **控制技术：**控制系统的结构方式、多处理机结构  

### 电信交换节点的基本功能

+ **交换节点可控制的接续类型：**本局接续、出局接续、入局接续、转接接续  
+ **交换节点必须具备的基本功能**
  + 能正确接收和分析从用户线或中继线发来的呼叫信号、地址信号
  + 能按目的地址正确地进行选路以及在中继线上转发信号
  + 能控制连接的建立与拆除  

# 二、交换网络

## 交换网络的构成

**交换**的基本功能是在任意的入线和出线之间建立连接

![image-20210608110100559](https://gitee.com/cmz2000/album/raw/master/image/image-20210608110100559.png)

**交换单元**是构成交换网络的最基本的部件

![image-20210608110704389](https://gitee.com/cmz2000/album/raw/master/image/image-20210608110704389.png)

在交换系统中完成交换这一基本功能的部件就是**交换网络**（或**交换结构** `Switching Fabric`），它是交换系统的核心。

交换网络是由若干个*交换单元*按照一定的*拓扑结构*和*控制方式*构成的。

**交换单元**是构成交换网络的最基本的部件。

## 交换单元

### 基本概念

![image-20210608182127981](https://gitee.com/cmz2000/album/raw/master/image/image-20210608182127981.png)

#### 分类

+ **按入出线的信息传送方向**
  + 有向交换单元：当信息经过交换单元时只能从入线进、出线出，具有唯一确定的方向
  + 无向交换单元：交换单元的每条线即可入也可出

![image-20210608182412160](https://gitee.com/cmz2000/album/raw/master/image/image-20210608182412160.png)

![image-20210608182426621](https://gitee.com/cmz2000/album/raw/master/image/image-20210608182426621.png)

![image-20210608182440315](https://gitee.com/cmz2000/album/raw/master/image/image-20210608182440315.png)

+ **按入出线的数量关系**

![image-20210608182526168](https://gitee.com/cmz2000/album/raw/master/image/image-20210608182526168.png)

+ **按入出线之间是否共享单一通路**

![image-20210608182714624](https://gitee.com/cmz2000/album/raw/master/image/image-20210608182714624.png)

+ **按交换单元所接收的信号**
  + 数字交换单元
  + 模拟交换单元  

#### 性能

![image-20210608183913515](https://gitee.com/cmz2000/album/raw/master/image/image-20210608183913515.png)

### 开关阵列

#### 概念

在交换单元内部，要建立任意入线和任意出线之间的连接，就在每条入线和每条出线之间都各自接上一个开关，所有开关就构成了交换单元内部的**开关阵列**

![image-20210608184646648](https://gitee.com/cmz2000/album/raw/master/image/image-20210608184646648.png)

#### 开关

+ 开关的位置：入、出线交叉点
+ 开关的表示： K~ij~ （i 为入线， j 为出线）
+ 开关的状态：通、断
+ 开关的种类：单向、双向  

![image-20210608185114897](https://gitee.com/cmz2000/album/raw/master/image/image-20210608185114897.png)

#### 实现

##### 有向阵列单元

![image-20210608185516545](https://gitee.com/cmz2000/album/raw/master/image/image-20210608185516545.png)

##### 无向阵列单元

![image-20210608185659790](https://gitee.com/cmz2000/album/raw/master/image/image-20210608185659790.png)

![image-20210608185738631](https://gitee.com/cmz2000/album/raw/master/image/image-20210608185738631.png)

##### 全连通和部分连通交换单元

![image-20210608190144603](https://gitee.com/cmz2000/album/raw/master/image/image-20210608190144603.png)

##### 多路选择器

![image-20210608190332805](https://gitee.com/cmz2000/album/raw/master/image/image-20210608190332805.png)

#### 特性

+ 容易实现广播功能
+ 从入线到出线具有均匀的单位延迟时间
+ 控制信号简单
+ 开关阵列适合于构成较小的交换单元（开关数反映了实现的复杂度和成本的高低）
+ 交换单元的性能依赖于所使用的开关

![image-20210608190507917](https://gitee.com/cmz2000/album/raw/master/image/image-20210608190507917.png)

### 空间交换单元

#### 概念

空间交换单元也称为**空间接线器**（Space Switch），简称为 S单元 或 S接线器

#### 基本结构

![image-20210608191412485](https://gitee.com/cmz2000/album/raw/master/image/image-20210608191412485.png)

+ **S接线器的构成：** 交叉点矩阵（开关阵列）、控制存储器（CM - Control Memory）
  + S 接线器所含 CM 数量等于入（出）线数
  + 每个 CM 所含有的存储单元个数等于入（出）线上的复用时隙数
  + 每个存储单元为 m 位 bit，且满足 N≤2……m，其中N为接线器的入（出）线数。 
+ 空间接线器的**控制存储器**控制每条输入复用线与输出复用线上的各个交叉点开关在何时打开或关闭。
+ 空间接线器控制存储器的数量等于输入线数或输出线数，而每个控制存储器所含的单元数等于输入线或输出线所复用的时隙数。

#### 控制方式

##### 输入控制方式

控制存储器按照输入复用线配置，即控制每条输入复用线上应该打开的交叉点开关。

![image-20210608193017027](https://gitee.com/cmz2000/album/raw/master/image/image-20210608193017027.png)

##### 输出控制方式

控制存储器按照输出复用线配置，即控制每条输出复用线上应该打开的交叉点开关。

![image-20210608193834342](https://gitee.com/cmz2000/album/raw/master/image/image-20210608193834342.png)

#### 特点

1. 只完成空间交换，不进行时隙交换，即完成输入复用线与输出复用线相同时隙内信息的空间交换。
2. 空间接线器按时分方式工作。空间交换单元的输入线和输出线都是时分复用线，交叉点矩阵的各个开关均按照复用时隙而高速接通和闭合，因而它按照时分方式工作。

### 时间交换单元

#### 概念与一般构成

![image-20210608194732034](https://gitee.com/cmz2000/album/raw/master/image/image-20210608194732034.png)

相对于空间交换单元而言，时分交换单元的内部只存在一条唯一的通路，该通路由输入复用线上各子信道分时共享，通常人们根据时分交换单元内这个唯一的公共通路是存储器还是总线，将时分交换单元划分为两种类型：**共享存储器型交换单元**和**共享总线型交换单元**。

共享存储器型交换单元：

![image-20210608195841570](https://gitee.com/cmz2000/album/raw/master/image/image-20210608195841570.png)

共享总线型交换单元：

![image-20210608195927615](https://gitee.com/cmz2000/album/raw/master/image/image-20210608195927615.png)

+ **时间接线器**（Time Switch），也称为 T 接线器，是一个典型的**共享存储器型**的交换单元，它的输入是一条同步时分复用线，输出也是一条同步时分复用线。下面我们也是具体了解时间接线器（共享总线型交换单元不做介绍）。
+ **基本结构：**
  + **话音存储器**（SM : Speech Memory）：暂存话音的数字编码信息，每个单元至少 8 比特， SM 所含单元数等于输入复用线上每帧的时隙数。
  + **控制存储器：**单元数等于 SM 的单元数，设 CM 每个单元为 c bit， SM 的单元数为 n， 则有 2^c^=n， n 也就是复用线上的时隙数。  

#### 控制方式

对于时间接线器，通常按照其控制存储器存储的内容是输出话音在话音存储器中的存储地址，还是输入话音在话音存储器中的存储地址，把控制存储器对话音存储器的控制方式分为输出控制方式和输入控制方式。

##### 输出控制方式

![image-20210608202706600](https://gitee.com/cmz2000/album/raw/master/image/image-20210608202706600.png)

在输出控制方式下，时间接线器**入复用线**来的信息按照时隙号顺序写入话音存储器相对于的单元中，即第 i 路时隙的 8 bit 话音存入话音存储器地址为 i 的单元。

通过例子理解：把入复用线上的 TS~0~、TS~1~、TS~2~、TS~3~ 分别交换到出复用线上的 TS~3~、TS~2~、TS~1~、TS~0~

![image-20210608204344114](https://gitee.com/cmz2000/album/raw/master/image/image-20210608204344114.png)

![image-20210608202350772](https://gitee.com/cmz2000/album/raw/master/image/image-20210608202350772.png)

前半周期写入，后半周期读出（SM）

前半周期写入，后半周期读出（CM）

工作方式可以总结为：**顺序写入，控制读出**

##### 输入控制方式

![image-20210608202727060](https://gitee.com/cmz2000/album/raw/master/image/image-20210608202727060.png)

在输入控制方式下，当入复用线上第 i 个时隙到来时，接线器从控制存储器第 i 个单元读出一个地址 j，该地址是话音存储器存储的 i 时隙信息的地址，随后接线器把输入复用线上第 i 个时隙的信息存储在话音存储器的 j 单元，对于出复用线来说，当第 j 个时隙到来时，话音存储器 j 单元的信息被顺序读出。

通过例子理解：把入复用线上的 TS~0~、TS~1~、TS~2~、TS~3~ 分别交换到出复用线上的 TS~3~、TS~2~、TS~1~、TS~0~

![image-20210608204440724](https://gitee.com/cmz2000/album/raw/master/image/image-20210608204440724.png)

![image-20210608202911411](https://gitee.com/cmz2000/album/raw/master/image/image-20210608202911411.png)

前半周期读出，后半周期写入（SM）

前半周期写入，后半周期读出（CM）

工作方式可以总结为：**控制写入，顺序读出**

#### 特性

+ T 接线器的控制存储器——交换控制表
+ 话音存储器和控制存储器的访问速度应满足一个时隙内各完成一次读写操作
+ T 接线器交换信息存在着时延， 时延最好的情况是入复用线上第 i 个时隙的信息要交换到出复用线第 i 个时隙， 时延最坏的情况是入复用线上第 i 个时隙的信息要交换到出复用线上第 i-1 个时隙。  

## 交换网络

### 基本概念

交换网络是由若干个交换单元按照一定的拓扑结构和控制方式构成的网络。
交换网络的三个基本要素是： **交换单元**、不同交换单元间的**拓扑连接**和**控制方式**。

#### 一般结构

![image-20210608210047404](https://gitee.com/cmz2000/album/raw/master/image/image-20210608210047404.png)

#### 分类

##### 单级和多级

交换网络按拓扑连接方式可分为：单级交换网络、多级交换网络  

###### 单级交换网络

单级交换网络是由一个或者多个位于同一级的交换单元所构成的交换网络，即需要交换的信息从交换网络入线到交换网络出线只经过**一个**交换单元，并且当同一级有多个交换单元构成时， 不同交换单元的入线与出线之间可建立连接。  

![image-20210608211210929](https://gitee.com/cmz2000/album/raw/master/image/image-20210608211210929.png)

###### 多级交换网络

多级交换网络通常称为多级互连网络（MIN : Multistage Interconnection Network），需要交换的信息从交换网输入端到交换网输出端需要经过多个交换单元。

如果一个交换网络中的交换单元可以分为 K 级，顺序命名为第 1，2，…，K 级，并且满足：

+ 所有入线都只与第1级交换单元连接

+ 所有第 1 级交换单元都只与入线和第 2 级交换单元连接

+ 所有第 2 级交换单元都只与第 1 级和第 3 级交换单元连接

+ 依此类推，所有第 K 级交换单元都只与第 K-1 级和出线连接

则称这样的交换网络为多级交换网络，或 K 级交换网络。

![image-20210608212024782](https://gitee.com/cmz2000/album/raw/master/image/image-20210608212024782.png)

![image-20210608212012463](https://gitee.com/cmz2000/album/raw/master/image/image-20210608212012463.png)

##### 有阻塞和无阻塞

交换网络的阻塞是指从交换网络不同输入端来的信息在交换网络中交换时发生了对同一**公共资源**争抢的情况，这时在竞争资源中失败的信息就会被阻塞，直到这个公共资源被释放。

阻塞的两种情况： **内部竞争、出线竞争**

![image-20210608212835138](https://gitee.com/cmz2000/album/raw/master/image/image-20210608212835138.png)

###### 严格无阻塞网络

不管网络处于何种状态，**任何时刻**都可以在交换网络中建立一个连接，只要这个连接的起点、终点是**空闲**的，而不会影响网络中已建立起来的连接。

###### 可重排无阻塞网络

不管网络处于何种状态，**任何时刻**都可以在交换网络中直接或**对已有的连接重选路由**来建立一个连接，只要这个连接的起点、终点是**空闲**的，而不会影响网络中已建立起来的连接。

![image-20210608213528580](https://gitee.com/cmz2000/album/raw/master/image/image-20210608213528580.png)

###### 广义无阻塞网络

指一个给定的网络存在着固有的阻塞可能，但又可能存在着一种**精巧的选路方法**，使得所有的阻塞均可避免，而不必重新安排网络中已建立起来的连接。

##### 单通路和多通路

单通路交换网络：任一条入线和出线之间只存在唯一的一条通路

多通路交换网络：任一条入线和出线之间存在多条通路



![image-20210608213602068](https://gitee.com/cmz2000/album/raw/master/image/image-20210608213602068.png)

##### 时分和空分

时分交换网络：时分结构的基本特征是所有的输入与输出端口分时共享单一的通信通路，具有时隙交换功能。

空分交换网络：空分结构的基本特征是可以在多对输入端口与输出端口间同时并行地传送信息，具有空间交换的功能。

### CLOS 网络

#### 概念

CLOS网络是指为了降低多级交换网络的成本，长期以来人们一直在寻找一种交叉点数随入线、出线数增长较慢的交换网络，其基本思想是采用多个较小规模的交换单元按照某种连接方式连接起来形成多级交换网络。

通过例子来理解：要构造 100 X 100 的交换网络 

![image-20210611141900194](https://gitee.com/cmz2000/album/raw/master/image/image-20210611141900194.png)

![image-20210611142242549](https://gitee.com/cmz2000/album/raw/master/image/image-20210611142242549.png)

![image-20210609100424337](https://gitee.com/cmz2000/album/raw/master/image/image-20210609100424337.png)

为了减少交叉点总数而同时具有严格的无阻塞特性，CLOS C. 很早就提出一种多级结构，推出了严格无阻塞的条件，这就是著名的 CLOS 网络。3 级 CLOS 网络应用广泛，除特别说明，一般 CLOS 网络也指 3 级 CLOS 网络。

一个 N X N 3 级 CLOS 网络的基本结构如下图，N 为入线、出线数。

![image-20210609101021417](https://gitee.com/cmz2000/album/raw/master/image/image-20210609101021417.png)

+ 一个 K 级互连网络， 第 k 级（1≤k≤K）有 r~k~ 个交换单元（1, 2,…r~k~），第 j 个交换单元表示为 S (j,k)，假设同一级的各个交换单元具有相同的入线数和出线数， 则 S (j, k) 的入线数可记为 m~k~，出线数可记为 n~k~。
+ 如果一个多级互连网络的每个交换单元都与下一级的 r~k+1~ 个交换单元有且只有一条连线， 则：n~k~ = r~k+1~ , m~k~ = r~k-1~。
+ 满足上述条件的 3 级互连网络称为 CLOS 网络

![image-20210611142801605](https://gitee.com/cmz2000/album/raw/master/image/image-20210611142801605.png)

#### 3 级 CLOS 网络无阻塞条件

**严格无阻塞：**任意入线到任意出线在任何情况下都可连接

3 级 CLOS **严格无阻塞**网络条件：`m ≥ 2n-1` 或 r~2~ ≥ m~1~ + n~3~ - 1

**推导过程如下：**如果要确立一条从 a --> b 的信息交换通路，那么最不利的情况是：第 1 级与 a 相连的交换单元中除去 a 之外所有剩余的 n-1 条入线均处于忙状态，并且所有的 n-1 条输出线都连接到第 2 级**不同**的交换单元上；最后 1 级与 b 相连的交换单元除b以外所有的 n-1 条输出线也处于忙状态，并且对于第 2 级来说需要另外的 n-1 个交换单元，且这些交换单元都要有一条出线连接到与 b 相连的交换单元上。那么在最坏情况下，共需要 `(n-1)+(n-1)=2(n-1)` 个可供选择的第2级交换单元，这时为了确保链路无阻塞，完成 a-->b 的信息交换，至少还应存一条空闲链路，即中间级交换单元要有 `(n-1)+(n-1)+1=2n-1` 个。

![image-20210609105502096](https://gitee.com/cmz2000/album/raw/master/image/image-20210609105502096.png)

**可重排无阻塞：**只要对已有连接进行重排， 就能保证任意入线到任意出线可连接。

3 级 CLOS **可重排无阻塞**网络条件：`m ≥ n` 或 r~2~ ≥ Max(m~1~, n~3~)

#### 构造举例

##### 构造无阻塞的 100 X 100 交换网络

其中 `n=10`，严格无阻塞时，应有 `m ≥ 2n-1 = 19` 

![image-20210609105958991](https://gitee.com/cmz2000/album/raw/master/image/image-20210609105958991.png)

##### 8 X 8 可重排无阻塞网络的构造

![image-20210611145421662](https://gitee.com/cmz2000/album/raw/master/image/image-20210611145421662.png)

![image-20210611145440057](https://gitee.com/cmz2000/album/raw/master/image/image-20210611145440057.png)

### TST 网络

#### 网络结构

TST 网络是电话交换系统中经常使用的一种3级网络，由两级 T 接线器与一级 S 接线器组合而成，能够完成不同复用线上的不同时隙内的信息交换。

![image-20210609111127370](https://gitee.com/cmz2000/album/raw/master/image/image-20210609111127370.png)

T 接线器：时分，采用 PCM

S 接线器：空分

+ 每一条 PCM 线路连接到一个 T 接线器，有多少条输入或输出 PCM 线路，就有多少个 T 接线器。
+ S 级的出入线数决定于两侧 T 接线器的数量，即等于输入输出线数。

![image-20210609111506510](https://gitee.com/cmz2000/album/raw/master/image/image-20210609111506510.png)

TST 交换网络结构如图，它具有 32 条双向时分复用线，且每条时分复用线上由 32 个时隙，编号相同的入线和出线共同组成一条双向时分复用线。TST 交换网络的第 1 级有 32 个 T 接线器，第 2 级为一个 32 x 32 的 S 接线器，第 3 级由 32 个 T 接线器组成，分别连在每一条输出线上。

在上图中，第 1 级 T 接线器采用的是输出控制方式，第 3 级 T 接线器采用的是输入控制方式（当然第 1 级和第 3 级的控制方式也可以调换），而对于第 2 级 S 接线器采用何种方式均可。

#### 工作原理

**1）双向通路的建立**

交换网络一般建立双向通路（A-->B 方向和 B-->A 方向），为减少选路次数，简化控制，可使两个方向的内部时隙具有一定的对应关系，通常可相差半帧，俗称**反相法**，即：

> 设：N~f~ = 一帧的时隙数
> N~a~ = A 到 B 方向的内部时隙数（任选一个入线 x 和出线 y 都空闲的内部时隙）
> N~b~ = B 到 A 方向的内部时隙数（应用**反相法**求得）
> 则：**N~b~ = N~a~ + N~f~ / 2** 

**2）阻塞特性**

TST 网络完全无阻塞的条件：m（内部时隙数） = 2n（输入时隙数）

**3）控制方式**

第 1 级 T 接线器和第 3 级 T 接线器一般采用不同控制方式，第 2 级 S 接线器采用何种方式均可。

### BANYAN 网络

#### 基本结构

基于 banyan 的交换网络是具有多级结构的交换网络，它覆盖范围较广，包含许多子类。

> L 级 banyan：任何输入到输出之间的通路都经过 L 级
>
> > 规则 banyan : L 级 banyan 网络中，构成网络的所有交换单元都相同
> >
> > > 矩形 banyan：规则 banyan 的每个交换单元入线数和出线数都相等
> >
> > 不规则 banyan：各个交换单元不全相同

banyan 网络由若干个 2 X 2 的最小交换单元（也称为交叉连接单元）构成，交叉连接单元是具有 2 条入线和 2 条出线的电子开关元件，有 5 种工作状态，如下图

![image-20210609121205751](https://gitee.com/cmz2000/album/raw/master/image/image-20210609121205751.png)

#### 基本特性

##### 树型结构特性

从 banyan 的任一输入端口引出的一组通路形成了二分支树，级数越多，分支越多，级数 k = log~2~N，N = 总入线数或出线数，即 **2^k^=N**。

##### 自选路由特性

自选路由，即**给定出线地址**，不用外加控制命令，就可选到出线。可以使用对应于出端号的二进制码的选路标签来自动选路。

![image-20210609150243851](https://gitee.com/cmz2000/album/raw/master/image/image-20210609150243851.png)

##### 可扩展性（可规律构造）

banyan 的构成具有一定的规律，可以采用有规则的扩展方法将较小容量的 banyan 扩展成较大规模  

**构造方法**如下：

> 已有 N X N 的 BANYAN 网络，需构成 2N X 2N 的 BANYAN 网络，则可用 2 组 N X N， 再加上一组 N 个 2X2 交换单元构成。将 N 个 2X2 交换单元的入线作为该网络的入线，将每个 2X2 交换单元的出线分别与第一组的 N X N 和第二组的 N X N 的相连， 2 组 N X N 的出线即为网络的出线。

###### 构造举例

![image-20210609151054297](https://gitee.com/cmz2000/album/raw/master/image/image-20210609151054297.png)

![image-20210609151132639](https://gitee.com/cmz2000/album/raw/master/image/image-20210609151132639.png)

![image-20210609151154632](https://gitee.com/cmz2000/album/raw/master/image/image-20210609151154632.png)

![image-20210609151236991](https://gitee.com/cmz2000/album/raw/master/image/image-20210609151236991.png)

##### 单通路特性

banyan 的任一入端到任一出端之间，具有 1 条且仅有一条通路。

##### 内部竞争性

banyan 是具有内部竞争的有阻塞网络。

![image-20210609151314691](https://gitee.com/cmz2000/album/raw/master/image/image-20210609151314691.png)

###### 解决内部阻塞

1. 使用 排序 - banyan 网络
2. 构造多通路
   + 可以通过增加多级交换网络的级数来消除内部阻塞。（已有证明，若要完全消除 N X N 的 banyan 网络的内部阻塞，至少需要 2log~2~N - 1 级。）
   + 对应一个输出地址有多条链路。
   + 可以增加 banyan 网的平面树，构成多通道交换网络。

#### BATCHER-BANYAN 网络

为了满足 banyan 网络的无阻塞条件，可以在 banyan 网络前加入排序网络—— batcher 网络，构成 batcher-banyan 网络（B-B 网络）。

该网络也简称为 B-B 网，是由 BATCHER 排序网和 BANYAN 网组成，它成功地避免了 BANYAN 网络的内部阻塞，这是目前 ATM 交换机使用较多的一种网络。BATCHER 排序网是由 2X2 的比较器（BATCHER 比较器）构成的。

![image-20210609152350844](https://gitee.com/cmz2000/album/raw/master/image/image-20210609152350844.png)

![image-20210609152752525](https://gitee.com/cmz2000/album/raw/master/image/image-20210609152752525.png)

#### 基于BANYAN的多通路结构

为了减少或消除 banyan 的内部阻塞，提高吞吐率，除了构成 B-B 网络之外，还可以构成基于 banyan 的各种多通路网络。

##### 增长型banyan

![image-20210609153722836](https://gitee.com/cmz2000/album/raw/master/image/image-20210609153722836.png)

##### 扩展型banyan

![image-20210609153701991](https://gitee.com/cmz2000/album/raw/master/image/image-20210609153701991.png)

##### 膨胀型banyan

![image-20210609153601679](https://gitee.com/cmz2000/album/raw/master/image/image-20210609153601679.png)

##### 多平面banyan

多平面 banyan 网络也称为复份型 banyan 网络

![image-20210609153529157](https://gitee.com/cmz2000/album/raw/master/image/image-20210609153529157.png)

### BENES 网络

#### 基本概念

benes 网络是著名的多通路网络， 具有可重排无阻塞的特点。

![image-20210609154411762](https://gitee.com/cmz2000/album/raw/master/image/image-20210609154411762.png)

K = 2log~2~N - 1

可以看出， Benes 网络实际上相当于两个 banyan（banyan与反转banyan）的背对背相连， 并将中间相邻两级合并为 1 级。 由于每个 banyan 有 log~2~N 级， 因此 Benes 网络共有 2log~2~N - 1 级。

#### 可规律构造

benes 网络的构成也有一定的规律。 使用 2X2 交换单元的 N X N benes 网络的构成方法为：两侧各有 N/2 个 2X2 交换单元， 中间为两个 N/2 X N/2 的子网络， 每个交换单元以一条链路连到每个子网络；再将中间子网络按上述方法继续分解，直到中间子网络就是 2X2 交换单元为止。

![image-20210609192434320](https://gitee.com/cmz2000/album/raw/master/image/image-20210609192434320.png)

# 三、电话交换系统

我国电话通信网采用 5 级结构，其网络拓扑为分层的树形结构。国内长途电话网由 4 个等级的长途交换中心 C1、C2、C3、C4 和长途中继线路构成。本地网由长途编号区内的 C5 交换中心、用户终端设备、中继线路构成。

![image-20210615213209244](https://gitee.com/cmz2000/album/raw/master/image/image-20210615213209244.png)

## 电话交换机整机结构

![image-20210609195341897](https://gitee.com/cmz2000/album/raw/master/image/image-20210609195341897.png)

### 本地电话网

#### 单局制电话网

![image-20210615213714865](https://gitee.com/cmz2000/album/raw/master/image/image-20210615213714865.png)

#### 多局制电话网

![image-20210615213751490](https://gitee.com/cmz2000/album/raw/master/image/image-20210615213751490.png)

#### 汇接制电话网

**汇接方式**主要有去话汇接、来话汇接、来去话汇接、主辅汇接等。

![image-20210615213927148](https://gitee.com/cmz2000/album/raw/master/image/image-20210615213927148.png)

##### 去话汇接

![image-20210615213935463](https://gitee.com/cmz2000/album/raw/master/image/image-20210615213935463.png)

##### 来话汇接

![image-20210615214011108](https://gitee.com/cmz2000/album/raw/master/image/image-20210615214011108.png)

##### 来去话汇接

![image-20210615214021771](https://gitee.com/cmz2000/album/raw/master/image/image-20210615214021771.png)

##### 主辅汇接

![image-20210615214031565](https://gitee.com/cmz2000/album/raw/master/image/image-20210615214031565.png)

### 交换机的基本功能和组成

+ 信号监视：识别外线状态变化、接收号码
+ 连接与控制：振铃控制、话音A/D、接续控制
+ 管理  

![image-20210609195608711](https://gitee.com/cmz2000/album/raw/master/image/image-20210609195608711.png)

## 交换机的话路部分

### 电话机的基本结构和功能

![image-20210609201155410](https://gitee.com/cmz2000/album/raw/master/image/image-20210609201155410.png)

+ **极性保护：**交换机向用户提供直流电，该电路保证：无论外部 a、b 线极性如何，内部电路 c、d 的极性固定

+ **通话设备**（送话、受话、 2/4 变换、消侧音）

  ——模拟话音信号通过用户线送给交换机

+ **转换设备**（叉簧）：挂机时，将外线与振铃电路接通，等待呼入；摘机时，将外线与拨号电路、通话设备接通。

  ——可通过直流回路的通断表明用户的摘挂机状态

+ **信号设备**（拨号、振铃）
  ——振铃电路： 接受交换机送来的 25Hz 铃流进行振铃
  ——音频拨号电路： 每个号码为双音频组合，通过 DTMF 发号器送给交换机

### 用户电路功能

**BORSCHT**

+ **馈电 B**attery feeding：向用户提供直流馈电电流，馈电电压 -48V
+ **过压保护 O**vervoltage protection：保证ab线上的内线电压在 0 ~ -48V 之间
+ **振铃控制 R**ing control：控制是否向用户线发送 25Hz 铃流信号
+ **监视 S**upervision：监视用户环路的通断状态
+ **编译码和滤波 C**ODEC&filters：模拟话音信号与 64Kbps 数字话音信号转换
+ **混合电路 H**ybrid circuit：2/4 变换
+ **测试 T**est：控制是否进行内外线的故障检测

### 用户模块

![image-20210609204905010](https://gitee.com/cmz2000/album/raw/master/image/image-20210609204905010.png)

+ **用户电路：**每条用户线有一个用户电路，完成信号采集、动作驱动、话音传输等功能
+ **交换电路：**用户及交换和话务集中（集中比为 2:1 或 4:1）
+ **收号器：**接收用户的 DTMF 号码，各种交换机设计不同，收号器可能位于中央交换网络侧
+ **扫描存储器：**接收各个用户电路的监视信息，送用户处理机
+ **信号分配存储器：**接收用户处理机对各用户电路的**控制**指令，控制各用户电路继电器的动作
+ **用户处理机：**与中央处理机协调控制用户电路和交换电路的工作
+ **通信电路**（信号提取插入）：负责收发用户处理机与中央处理机间通信的信息

### 数字中继器

![image-20210615210800566](https://gitee.com/cmz2000/album/raw/master/image/image-20210615210800566.png)

### 数字交换和数字交换网络

#### 数字交换

##### 基本功能

实现任意两个用户间的语音交换。 即：任意母线上任意时隙间的交换

##### 常用方法

**共享存储器、开关阵列、共享总线**，及其组合、级连网络。针对电话交换的业务特点，交换网络的控制方式上又有其具体特点。

#### 数字交换网络

##### 空间（S）接线器

+ 实现一个时隙内任意母线间的交换

![image-20210609213615795](https://gitee.com/cmz2000/album/raw/master/image/image-20210609213615795.png)

##### 时间（T）接线器

+ 实现一条母线上的时隙交换（同步时分复用信号）

![image-20210609213636669](https://gitee.com/cmz2000/album/raw/master/image/image-20210609213636669.png)

##### T、S 组合型数字交换网络

![image-20210609214304218](https://gitee.com/cmz2000/album/raw/master/image/image-20210609214304218.png)

##### T 级联型交换网络

![image-20210609214427964](https://gitee.com/cmz2000/album/raw/master/image/image-20210609214427964.png)

#### 串并复用与T接线器

![image-20210611150959130](https://gitee.com/cmz2000/album/raw/master/image/image-20210611150959130.png)

内部时隙与外部时隙的换算关系如下：

> **（外部时隙）PCM~i~ 上的时隙 TS~j~ <==> （内部时隙）TS号 j * PCM线总数 m + PCM号 i** 

#### 数字交换机中的话路连接

![20210616161235](https://gitee.com/cmz2000/album/raw/master/image/20210616161235.png)

![image-20210609215656202](https://gitee.com/cmz2000/album/raw/master/image/image-20210609215656202.png)

![image-20210615153354942](https://gitee.com/cmz2000/album/raw/master/image/image-20210615153354942.png)

## 程控交换软件

![image-20210609220324107](https://gitee.com/cmz2000/album/raw/master/image/image-20210609220324107.png)

中继续：连接交换机网络

**特点**如下：

程控交换机运行的特点是业务量大，实时性和可靠性要求高，因此程控交换软件要具有较高的实时效率，能处理大量的呼叫，而且能保证通信业务不间断。（实时性，并发性，业务不间断性，通用性）

程序：

+ **操作系统：**实时，多任务
+ **呼叫处理：**管理接口和网络资源，处理呼叫过程
+ **系统监视和故障处理：**监视**重要**的软件模块和**公用**硬件设备，发现故障后进行相应处理
+ **故障诊断：**故障定位；例行测试
+ **维护和运行：**业务质量观察，业务变更处理，人机交互  

数据：

+ **局数据**
+ **用户数据**

### 呼叫处理原理

![image-20210610105225844](https://gitee.com/cmz2000/album/raw/master/image/image-20210610105225844.png)

#### 本局呼叫处理过程

![image-20210610105535952](https://gitee.com/cmz2000/album/raw/master/image/image-20210610105535952.png)

![image-20210610105554579](https://gitee.com/cmz2000/album/raw/master/image/image-20210610105554579.png)

![image-20210610105606962](https://gitee.com/cmz2000/album/raw/master/image/image-20210610105606962.png)

#### 呼叫处理的特点

+ 整个呼叫处理过程可分为若干个阶段，每个阶段可以用一个稳定的状态来表示；
+ 整个呼叫处理的过程就是在一个稳定状态下，处理机监视、识别输入信号，进行分析处理，执行任务并输出命令，然后跃迁到下一个稳定状态的循环过程；
+ 两个稳定的状态之间要执行各种处理；
+ 在一个稳定状态下，若没有输入信号，状态不会迁移；
+ 相同的输入信号在不同的状态下会有不同的处理，并迁移到不同的状态；
+ 在同一状态下，对不同输入信号的处理是不同的；
+ 在同一状态下，输入同样信号，也可能因不同情况得出不同结果。

### SDL 图（规范与描述语言）

![image-20210615223159967](https://gitee.com/cmz2000/album/raw/master/image/image-20210615223159967.png)

![image-20210610145245585](https://gitee.com/cmz2000/album/raw/master/image/image-20210610145245585.png)

![image-20210610145315922](https://gitee.com/cmz2000/album/raw/master/image/image-20210610145315922.png)

![image-20210610145356204](https://gitee.com/cmz2000/album/raw/master/image/image-20210610145356204.png)

![image-20210610145408341](https://gitee.com/cmz2000/album/raw/master/image/image-20210610145408341.png)

### 输入处理（数据采集）

识别并接收外部的处理请求和信号（摘机信号、挂机信号、所拨号码和超时信号等），生成事件

对用户线、中继线、信令设备进行监视和信号识别，生成相应事件放入队列，供其它程序取用。大多属于周期级程序。

输入处理程序需要完成的功能主要用五个：

+ 用户线扫描监视：监视用户线状态是否发生了变化。
+ 中继线线路信号扫描：监视采用随路信令的中继线的状态是否发生了变化。
+ 接收各种信号：包括拨号脉冲、DTMF 信号和 MFC 信号等。
+ 接收公共信道信令。
+ 接收操作台的各种信号。

#### 用户线扫描

![image-20210610143637805](https://gitee.com/cmz2000/album/raw/master/image/image-20210610143637805.png)

##### 目的

检测和识别用户线上的摘机（直流回路接通）、挂机（直流回路断开）信号和用户拨号信号。

+ 摘机：线路状态 “断” (1) --> “续” (0)
+ 挂机：线路状态 “续” (0) --> “断” (1)

![image-20210610142450211](https://gitee.com/cmz2000/album/raw/master/image/image-20210610142450211.png)

##### 周期

100 ~ 200 ms

#### 摘挂机识别

##### 原理

设程控交换机摘挂机扫描程序的执行周期是 200ms，那么摘机识别就是在 200ms 的周期性扫描中找到从 “1” 到 “0” 的变化点，挂机识别就是在 200ms 的周期性扫描中找到从 “0” 到 “1” 的变化点。

![image-20210610142858451](https://gitee.com/cmz2000/album/raw/master/image/image-20210610142858451.png)

##### 程序流程

![image-20210610143141380](https://gitee.com/cmz2000/album/raw/master/image/image-20210610143141380.png)

##### 群处理

**目的：**提高效率

![image-20210610143358657](https://gitee.com/cmz2000/album/raw/master/image/image-20210610143358657.png)

##### 按组识别用户摘挂机流程

![image-20210610143456164](https://gitee.com/cmz2000/album/raw/master/image/image-20210610143456164.png)

#### DTMF 音频号码接收

![image-20210610144120404](https://gitee.com/cmz2000/album/raw/master/image/image-20210610144120404.png)

+ DTMF收号器
  输出数据：SP（1bit）-->0 ：有号；1：无号
  Q1~Q4（4bits） ——BCD 号码
+ 扫描目的：识别来号事件， 并读取号码。
  来号：SP状态“无号” (1) --> “有号” (0)；
+ 扫描周期：16~20ms
+ 扫描原理

![image-20210610144835007](https://gitee.com/cmz2000/album/raw/master/image/image-20210610144835007.png)

### 分析处理（数据处理）

输入处理得到的各种事件（当前状态、输入信息、用户数据、可用资源等），交由分析处理程序分析，以决定下一步的工作。它没有固定周期，属于基本级程序。

![image-20210615223159967](https://gitee.com/cmz2000/album/raw/master/image/image-20210615223159967.png)

#### 状态分析

![image-20210610151134072](https://gitee.com/cmz2000/album/raw/master/image/image-20210610151134072.png)

#### 去话分析、号码分析、来话分析

![image-20210610151417763](https://gitee.com/cmz2000/album/raw/master/image/image-20210610151417763.png)

![image-20210610151445618](https://gitee.com/cmz2000/album/raw/master/image/image-20210610151445618.png)

![image-20210615222338370](https://gitee.com/cmz2000/album/raw/master/image/image-20210615222338370.png)

![image-20210615222352920](https://gitee.com/cmz2000/album/raw/master/image/image-20210615222352920.png)

![image-20210615223320267](https://gitee.com/cmz2000/album/raw/master/image/image-20210615223320267.png)

### 任务执行和输出处理

任务执行是指从一个稳定状态迁移到下一个稳定状态之前，根据分析处理的结果，处理及完成相关任务的过程。

+ 分配和释放各种资源，如对 DTMF 收号器、时隙的分配和释放
+ 启动和停止各种计时器，如启动 40s 忙音计时器，停止 60s 振铃计时器等
+ 形成信令、处理机间通信消息和驱动硬件的控制命令，如接通话路命令等
+ 开始和停止计费，如记录计费相关数据等
+ 计算操作，如计算已收号长，重发消息次数等
+ 存储各种号码，如被叫号码等
+ 对用户数据、局数据的读写操作

输出处理程序输出各种命令，完成具体的动作。有些属于基本级程序，有些属于周期级程序。输出处理主要包括：

+ 送各种信号音、停各种信号音，向用户振铃和停振铃
+ 驱动交换网络建立或拆除通话话路
+ 连接 DTMF 收号器
+ 发送公共信道信令
+ 发送线路信令和 MFC 信令
+ 发送处理机间通信信息
+ 发送计费脉冲等

### 任务分级和级间转移

| 程序级别 | 程序功能                       | 启动方式     | 响应速度         |
| -------- | ------------------------------ | ------------ | ---------------- |
| 故障级   | 故障识别和故障紧急处理         | 硬件中断启动 | 立即响应         |
| 周期级   | 按一定周期进行的各种扫描和驱动 | 时钟中断启动 | 在严格时限内响应 |
| 基本级   | 分析处理和各种无时限任务       | 事件队列启动 | 在一定时限内响应 |

![image-20210610155328764](https://gitee.com/cmz2000/album/raw/master/image/image-20210610155328764.png)

#### 任务调度

![image-20210610155547400](https://gitee.com/cmz2000/album/raw/master/image/image-20210610155547400.png)

+ **周期级调度**
  + 在单任务操作系统中， 可以利用**时钟中断+时间表**的方法调度周期级任务
  + 在实时多任务操作系统中， 可以设置任务周期， 利用操作系统的调度机制调度周期级任务
+ **基本级调度**
  + 在单任务操作系统中， 可以自己设计**事件队列**调度基本级任务
  + 在实时多任务操作系统中， 可以利用操作系统的事件队列、 信箱等机制驱动基本级任务。

![image-20210610160635405](https://gitee.com/cmz2000/album/raw/master/image/image-20210610160635405.png)

### 呼叫处理能力BHCA

#### 概念

+ 在保证**规定的服务质量标准**的前提下， 控制部件（ 处理机系统） 在**单位时间**内**能够**处理的最大**试呼**次数。
+ 以 “最大忙时试呼次数” 表示。 简写 BHCA

#### 计算模型

**t = a + b N**

> t（系统开销）：时间资源的占用率。
>
> a（固有开销）：与呼叫次数（话务量） 无关的系统开销， 如：任务调度和扫描开销。
>
> b：处理一次呼叫的平均开销， 包括操作系统部分和呼叫处理部分开销。
>
> N：呼叫次数。
>
> b N（非固有开销）：处理所有呼叫的系统开销。

##### 例题

![image-20210610162316539](https://gitee.com/cmz2000/album/raw/master/image/image-20210610162316539.png)

### 过负荷控制

**到达的话务负荷超过交换局的设计能力时， 称过负荷。**

+ 过负荷控制要求
  + 话务负荷超过设计能力 50% 时， 保证处理不低于 90% 设计能力的试呼。
+ 过负荷控制方法
  + 将呼叫源分成不同的等级， 限制低级源的呼叫， 优先高级源的呼叫。

![image-20210610162530998](https://gitee.com/cmz2000/album/raw/master/image/image-20210610162530998.png)



# 四、分组交换

## 路由器技术的发展

### 路由器工作原理

![image-20210610164605211](https://gitee.com/cmz2000/album/raw/master/image/image-20210610164605211.png)

![image-20210610164621474](https://gitee.com/cmz2000/album/raw/master/image/image-20210610164621474.png)

![image-20210610164640922](https://gitee.com/cmz2000/album/raw/master/image/image-20210610164640922.png)

### M40交换机举例

Juniper Network 公司推出的 IP 交换机，可用于 Internet 的骨干路由器、以太交换机、 ATM 交换机等。

![image-20210610165132296](https://gitee.com/cmz2000/album/raw/master/image/image-20210610165132296.png)

#### 结构

**路由部件（JUNOS）**

+ Internet 软件包，包括丰富的路由协议组件（OSPF、BGP4、 IS-IS 等）。
+ 根据路由协议更新路由表

**路由查找部件（Packet Process）**

+ 处理机级的 ASIC，与 JUNOS 软件相结合，使 M40 系统达到线速交换的水平。
+ 高速查找：最长匹配查找速度为每秒 40M 个路由，可支持 8*OC - 48 系统的线速路由查找。
+ 可编程：支持 IPv4、 MPLS、IPv6 和帧中继等多种协议。
+ 转发表自动更新： Routing Table 中的路由表更新后，自动刷新 Forwarding Table 的路由数据。

**线路卡（Line Card）**

+ 支持 SONET/SDH、ATM 和 DS3 等类接口 。

**交换单元（Switch Fabric）**

+ 40Gbps 的交换单元
+ 以共享存贮器为核心，配以适当的缓冲管理 ASIC 和 I/O 管理 ASIC，将每一个包分解成 64 字节的“块” （block）作为存贮、交换的基本单位
+ 通过“包通告”（Notification）进行交换控制。

#### 包转发工作原理

![image-20210610170012488](https://gitee.com/cmz2000/album/raw/master/image/image-20210610170012488.png)

1. 信息到达路由器的入线
2. 线路卡按不同线路的帧格式提出净荷，并将校验正确的帧送入 I/O 管理 ASIC
3. I/O 管理 ASIC 按不同的协议格式（IPv4 或 MPLS）提出 3 层的包，根据包的交换要求设置 “寻路关键字” ，并将包分段成 64 字节的块，一起送分布缓冲管理器
4. 缓冲管理器将“块”轮流放入共享存储器
5. 缓冲管理器根据块中的 “寻路关键字”  构造 “包通告” ，送寻路部件
6. 寻路部件查找路由
7. 寻路部件将包含了转发决定的 “包通告” 送缓冲管理器，缓冲管理器再将此包通告转发给输出端口的 I/O 管理器，输出端口的 I/O 管理器将所有的包通告排队，逐一处理
8. I/O 管理器处理到某一个包通告时，通过缓冲管理器产生一个读 “块” 的请求，将数据块读出
9. I/O 管理器将块重新组装成包，送线路卡
10. 线路卡按线路要求将数据包作为净荷置入线路帧格式中，发出。

## 宽带综合数字业务

### 综合业务数字网ISDN

![image-20210610171349408](https://gitee.com/cmz2000/album/raw/master/image/image-20210610171349408.png)

#### 基本特征

+ 端到端全数字连接
+ 提供多种业务
+ 统一的多用途接口

#### B-ISDN业务分类

![image-20210610175418728](https://gitee.com/cmz2000/album/raw/master/image/image-20210610175418728.png)

![image-20210610175430791](https://gitee.com/cmz2000/album/raw/master/image/image-20210610175430791.png)

![image-20210610175652393](https://gitee.com/cmz2000/album/raw/master/image/image-20210610175652393.png)

### ATM基本原理

#### ATM——异步转移模式

![image-20210610180058446](https://gitee.com/cmz2000/album/raw/master/image/image-20210610180058446.png)

#### 信元格式

![image-20210610180440072](https://gitee.com/cmz2000/album/raw/master/image/image-20210610180440072.png)

##### VCI / VPI

![image-20210610180545902](https://gitee.com/cmz2000/album/raw/master/image/image-20210610180545902.png)

#### ATM网络连接举例

+ 交换虚连接（SVC）
  + 由信令控制建立的连接，用户在传送信息前要建立连接，信息传送完毕则拆除虚连接。
+ 永久虚连接（PVC）
  + 由管理面控制建立的永久和半永久连接，用户在传送信息前不需要建立过程。

![image-20210610180910776](https://gitee.com/cmz2000/album/raw/master/image/image-20210610180910776.png)

![image-20210611153639774](https://gitee.com/cmz2000/album/raw/master/image/image-20210611153639774.png)

![image-20210611153728139](https://gitee.com/cmz2000/album/raw/master/image/image-20210611153728139.png)

## 多协议标记交换MPLS

### 概念

+ `Multi-Protocol Label Switching`
+ MPLS 是一个可以在多种第二层媒质上进行标记交换的网络技术。它结合了第二层的交换和第三层路由的特点，将第二层的基础设施和第三层的路由有机地结合起来。
+ MPLS 是一种有效的封装机制，通过在 packets（IP packets, AAL5, frames）上使用**标记** “Labels” 进行数据传递。
+ 同时可以支持**多协议**，也就是说它不仅可以支持多种上层网络协议，包括 IPv4、IPv6 等，而且可以运行于不同底层（ATM、FR、PPP）的网络之上，使得多种网络的互连互通成为可能
+ 当分组进入网络时，要为其分配**固定长度**的短标记，并将标记和分组封装在一起，在整个转发过程中，交换结点**仅根据标记**进行转发。

#### 基本模型

+ MPLS 是一种结合分组路由和电路交换的混合模型

![image-20210610182432368](https://gitee.com/cmz2000/album/raw/master/image/image-20210610182432368.png)

+ 使用固定长度的**标记**表示转发信息，使用**精确匹配**算法进行转发判决，故称**标记交换**

#### 技术思路和特点

![image-20210610182547940](https://gitee.com/cmz2000/album/raw/master/image/image-20210610182547940.png)

+ 采用**精确地址匹配**方法进行寻址
+ 路由选择和数据转发分开进行
+ 以路由判决为基础，先使用相关协议为信息流建立虚连接，分组按分配的标记为基础进行转发
+ 面向连接、支持多协议、标签交换

#### 与传统IP交换比较

+ **传统IP交换：**路由选择与数据转发同时进行，是无连接的
+ **MPLS技术：**路由选择和数据转发分开进行，是面向连接的

### MPLS的交换原理

#### 基本思想

边缘路由，核心交换

![image-20210610184145633](https://gitee.com/cmz2000/album/raw/master/image/image-20210610184145633.png)

#### 网络结构

![image-20210610184215959](https://gitee.com/cmz2000/album/raw/master/image/image-20210610184215959.png)

+ MPLS 标记边缘路由器（LER : Label Edge Router）：位于 MPLS 网络边缘，与其他网络或用户相连
+ MPLS 标记核心路由器（LSR : Label Switching Router）：位于 MPLS 网络内部
+ 标记交换路径（LSP : Label Switching Path）：MPLS 网络为具有一些共同特性的分组通过网络而选定的一条通路，由入口的 LER、一系列 LSR 和出口的 LER 以及它们之间由标记所标识的逻辑信道组成。
+ 标记转发协议（LDP : Label Distribution Protocol）
+ 转发等价类（FEC : Forward Equivalence Class）：FEC 是一组沿相同路径、有相同处理过程的数据分组。同一 FEC 具有相同的 Label，走相同的 LSP。
+ 标记信息库（LIB : Label Information Base）：保存转发一个打标分组所需要的信息

#### 基本交换原理

+ 建立连接
  + 通过 LDP 等协议，在 LSR 和 LER、LSR 和 LSR 之间完成标记信息的分发，形成与 FEC 对应的LSP路径
+ 数据传输
  + 入口 LER 接收分组，完成第三层功能，判定分组所属的 FEC，并给分组加上标记形成 MPLS 标记分组
  + LSR 依据分组上的标记以及标记转发表通过交换单元对其进行转发，不再进行任何第三层处理
  + 出口 LER 将分组中的标记去掉后转发至目的地
+ 拆除连接
  + 取消标记， 释放 LSP

### 标记分配过程

#### 标记分配协议

用于分配 Label，建立 LSP

+ LDP——普通标记分配协议
+ CR-LDP——限制路由的标记分配协议
+ RSVP Extension——扩展的资源预留协议

#### 标记分配过程（LDP）

+ **发现相邻的 LDP 对等体：**使用 UDP 广播，发现相邻 LSR
+ **建立 LDP 会话：**相邻 LSR 间建立 TCP 连接，并建立 LDP 会话
+ **建立 LSP：**标记由下游 LSR 分配，并沿 LDP 会话通知上游 LSR

#### 标记分配方式

![image-20210610192526732](https://gitee.com/cmz2000/album/raw/master/image/image-20210610192526732.png)

### 标记分配路由器

#### 组成

![image-20210610192904464](https://gitee.com/cmz2000/album/raw/master/image/image-20210610192904464.png)

+ 标签转发信息库 LFIB

  + 由路由判决模块创建，保存于转发模块中，供转发打标分组使用。

  + 包括多张表格

    > NHLFE——下一跳标签转发表目
    >
    > ILM——输入标签映射
    >
    > FTN——FEC 到 NHLFE 的映射

![image-20210610193543187](https://gitee.com/cmz2000/album/raw/master/image/image-20210610193543187.png)

+ 路由判决模块
  + 通过与其它LSR/LER交互路由协议创建LFIB表目
  + 在与一个FEC相关联的路由被删除或下一跳信息改变时，删除或更新相应LFIB表目
+ 转发模块
  + 转发功能框图

![image-20210610193239013](https://gitee.com/cmz2000/album/raw/master/image/image-20210610193239013.png)

#### 标记交换路由器 LSR

+ 运行传统 IP 选路协议，完成路由控制功能，更新和维护路由表
+ 运行 MPLS 控制协议，以与邻接设备协调FEC/标记的绑定信息
+ 建立和维护标记转发表 LIB，支持标记交换
+ 可以利用传统交换机扩充 IP 选路，或将一个传统路由器升级支持 MPLS

#### 标记边缘路由器 LER

+ 连接 MPLS 域和非 MPLS 域以及不同 MPLS 域
+ 与内部 MPLS LSR 交换 FEC / 标记绑定信息
+ 确定业务类型，进行FEC划分
+ 给分组加标记或删除标记
+ 传统 IP 选路功能
+ 实施 QoS 管理，接入流量工程控制  

# 五、信令与协议

## 概念

电话通信过程分为三个阶段：呼叫建立、通话、呼叫拆除。在呼叫建立和呼叫拆除过程中，用户和交换机之间、交换机和交换机之间都要交互一些控制消息，以协调相互的动作，这些控制消息称为**信令**。

### 信令过程举例

![image-20210610202009049](https://gitee.com/cmz2000/album/raw/master/image/image-20210610202009049.png)

**用户信令：**

+ 用户信令是用户和交换机之间的信令，在用户线上传送。
+ 模拟用户信令：主要包括用户向交换机发送的线路状态信令和地址选择信令，交换机向用户发送的铃流和忙音等音信号。用于PSTN。
+ 数字用户信令：通过消息的形式传送以上信息，用于ISDN用户。例如： DSS1， DSS2。

**局间信令：**

+ 局间信令是交换机之间（市--市、市--长、长--长）、交换机与网管中心、数据库（HLR、VLR）之间的信令。在局间中继线上传送，用来控制呼叫接续和拆线，以及与通信网管理和维护相关的信息。

### 随路信令方式

+ 呼叫接续过程中的各种信令均在该呼叫所占用的话路中传送（或信令通路与话路存在对应关系）

![image-20210610203307625](https://gitee.com/cmz2000/album/raw/master/image/image-20210610203307625.png)

### 公共信道信令方式

+ 信令通路与话音通路分开，且一条信令通路可以为多条话音通路服务
+ 信令传送速度快、信号容量大、可靠性高；
+ 不仅可以传送与电路接续有关的信号，还可以传送各种与电路接续无关的传令信息；
+ 具有改变或增加信令的灵活性，便于开放新业务。

![image-20210610203349698](https://gitee.com/cmz2000/album/raw/master/image/image-20210610203349698.png)

## 中国七号信令系统（No.7）

### 特点

+ 三级网
+ 共路信令系统
+ 信令传送模式——**统计时分复用，数据报方式（分组交换）**
+ 话路与信令通路分离
+ 信令消息中要包含识别该信令所对应的话路的标记信息
+ 需要单独的导通测试
+ 需要备用设备，保证可靠性

信令通路与话路的分离为信令网的产生和独立提供了技术基础

### 协议栈

![image-20210614192345852](https://gitee.com/cmz2000/album/raw/master/image/image-20210614192345852.png)

#### 信令单元基本格式

+ 信令单元是 No.7 信令系统中传送信令信息的数据包，由第二功能级处理，采用可变长度形式和整数个八位位组
+ **消息信令单元（MSU）**：用来运载高层（用户部分或信令网管理功能）产生的信令消息；
+ **链路状态信令单元（LSSU）**：用来传送链路状态信息；
+ **插入（填充）信令单元（FISU）**：在无 MSU 和 LSSU 可发时发送。

![image-20210615155337948](https://gitee.com/cmz2000/album/raw/master/image/image-20210615155337948.png)

#### 公共的消息传递部分

![image-20210615103731556](https://gitee.com/cmz2000/album/raw/master/image/image-20210615103731556.png)

#### 用户部分（重点TUP）

电话用户部分 TUP：提供电话呼叫的控制信令，完成电话呼叫接续和控制；处理 SIF 中的 CIC，H0 H1 和信令信息。

![image-20210615104151344](https://gitee.com/cmz2000/album/raw/master/image/image-20210615104151344.png)

##### TUP 消息类型

![image-20210615104507389](https://gitee.com/cmz2000/album/raw/master/image/image-20210615104507389.png)

+ 前向地址消息（FAM）
  + IAM：初始地址消息。
  + IAI：带附加信息的初始地址消息。
  + SAM：后续地址消息
  + SAO：只带一位号码的后续地址消息
  + GSM：一般建立消息
+ 后向建立消息（BSM）
  + GRQ：一般请求消息
+ 成功的后向建立消息（SBM）
  + ACM：地址全消息，表示被叫空闲，呼叫建立成功
+ 不成功后向建立消息（UBM）
  + SLB 市话忙、
  + STB 长话忙 、
  + CGC 电路群拥塞 、
  + SEC 交换机拥塞
+ 监视消息（CCM）：
  + 正常呼叫结束时电路释放监护消息（RLG）
+ 呼叫监视消息（CSM）：
  + ANC 被叫应答、计费消息
  + ANN 应答、免费
  + CLF 前向释放
  + CBK 后向释放
  + CCL 主叫挂机  

![image-20210615193734467](https://gitee.com/cmz2000/album/raw/master/image/image-20210615193734467.png)

![image-20210615193801307](https://gitee.com/cmz2000/album/raw/master/image/image-20210615193801307.png)

![image-20210615193821282](https://gitee.com/cmz2000/album/raw/master/image/image-20210615193821282.png)

### 信令网

#### 信令网与通信网

信令网**逻辑上独立**于通信网， 专门用于传送信令的网。 是现代通信网的支撑网。**物理上可以独立**于通信网， **也可以与通信网融为一体**。

![image-20210610204620806](https://gitee.com/cmz2000/album/raw/master/image/image-20210610204620806.png)

#### 信令网组成

+ 信令点（SP）和信令转接点（STP）—— 提供 No.7 信令的通信网节点。通常就是通信网的交换节点或处理节点，如：交换局、网管中心、数据库、智能网业务控制点等。
  + 信令源点
  + 信令目的点
  + 信令转接点 —— 独立的/综合的
+ 信令链路
  + 连接各个信令点，传送信令的物理链路。通常就是通信链路的一部分。可以是光纤、微波、PCM 电缆线路等。
  + 链路组：一束信令链路构成一个 “链路组” 。一个链路组常常包括所有并行的信令链路。

![image-20210610205218840](https://gitee.com/cmz2000/album/raw/master/image/image-20210610205218840.png)

#### 信令网结构

+ 国际网
  + 国际网与国内网的 No.7 标准可以不同，国际接口局完成转换
+ 国内网
  + 长途网 —— 三级
  + 本地网 —— 二级

##### 我国的信令网的3级结构示例

+ 第一级为高级信令转接点 HSTP，负责转接它汇接的第二级 LSTP 和第三级 SP 的信令消息。HSTP 采用独立型信令转接点设备。
+ 第二级为低级信令转接点 LSTP，负责转接它所汇接的第三级 SP 的信令消息。 LSTP 可以采用独立型信令转接设备；也可以采用与交换局合设在一起的综合式信令转接点设备。
+ 第三级为信令点 SP，它是信令网传递各种信令消息的源点或宿点，由各种交换局和特种服务中心，如业务控制点 SCP、网管中心 NMC 等组成。

![image-20210610210300949](https://gitee.com/cmz2000/album/raw/master/image/image-20210610210300949.png)

#### 信令网路由选择

![image-20210610210359759](https://gitee.com/cmz2000/album/raw/master/image/image-20210610210359759.png)

#### 信令工作方式和消息传递

![image-20210615193939552](https://gitee.com/cmz2000/album/raw/master/image/image-20210615193939552.png)

![image-20210615193957427](https://gitee.com/cmz2000/album/raw/master/image/image-20210615193957427.png)

![image-20210615194009643](https://gitee.com/cmz2000/album/raw/master/image/image-20210615194009643.png)

## SIP协议

略，通过抓包实验理解

![image-20210620213541890](https://gitee.com/cmz2000/album/raw/master/image/image-20210620213541890.png)

![image-20210620213459525](https://gitee.com/cmz2000/album/raw/master/image/image-20210620213459525.png)

# 六、移动交换

**漫游**指的是用户于原先申请的电信公司所提供服务的网络以外，在其他电信业者甚至是国外的电信业者所提供的电信网络范围使用语音通话、数据传输等电信服务，以使通讯可以保持而不中断。

**切换**（又称**越区切换**、**过区切换**）是指移动台在通话过程中从一个基站覆盖区移动到另一个基站覆盖区，或是由于外界干扰而切换到另一条话音信道上的过程。

## GSM

GSM 采用**电路方式**，提供 9.6/14.4kbps 的数据业务，但一个用户只能分配一个信道

### 结构

#### 移动台 MS

是移动客户设备部分，分为手持机和车载台。包括移动终端（**ME**），和手机客户识别卡（**SIM**），即 SIM 储值卡。

#### 无线基站子系统 BSS

由移动交换中心 MSC 控制，与 MS 进行通信的系统设备。主要完成无线发送接收和无线资源管理等功能。

+ 基站控制器 **BSC**
+ 基站收发信机 **BTS**

#### 交换网络子系统 NSS

主要完成交换功能和客户数据与移动性管理、安全性管理所需的数据库功能。

+ 移动交换中心 **MSC**：对位于本 MSC 控制区域内的移动用户进行通信控制和管理。
+ 归属位置寄存器 **HLR**：用来存储本地用户位置信息的数据库。
  + 即使用户漫游到 HLR 所服务的区域外， HLR 也要登记由该区传送来的位置信息。
  + 保证当呼叫一个移动用户时（不知它处于哪一个地区），均可由该移动用户的 HLR 获知它当前处于哪一个地区，进而建立起通信链路。
+ 访问位置寄存器 **VLR**：存储来访用户位置信息的数据库。
  + 当移动用户漫游到新的 MSC 控制区时，向该地区的 VLR 申请登记。
  + VLR 从该用户的 HLR 查询有关参数，给该用户分配一个新的漫游号码（MSRN），并通知其 HLR 修改该用户位置信息，准备为其它用户呼叫此移动用户时提供路由信息。
  + 如果移动用户由一个 VLR 服务区移动到另一个VLR服务区时，HLR 在修改该用户的位置信息后，还要通知原来的 VLR，删除此移动用户的位置信息。
+ 鉴权中心 **AUC**
+ 设备标志寄存器 **EIR**：存储移动台设备参数的数据库。

#### 操作维护子系统 OMC

主要是对整个 GSM 网路内各种部件进行功能监视、状态报告、故障诊断和设备管理。

#### 网关交换中心 GMSC

负责移动交换网络与固话网络（PSTN）的互联互通，需要进行呼叫接续控制（信令控制）和话音转发。

## GPRS

GPRS 按需动态占用资源，速率可达 171.2kbps

逻辑信道新增分组数据信道 PDCH，即采用电路交换 + 分组交换

![image-20210620194241471](https://gitee.com/cmz2000/album/raw/master/image/image-20210620194241471.png)

**GGSN** : Gateway GPRS Support Node，起网关作用，功能类似 GMSC，提供 GPRS 和多种不同的数据网络的互连

**SGSN** : Service GPRS Support Node，记录移动台的当前位置信息，对其进行鉴权、移动性管理和路由选择，功能类似于 GSM 中的 MSC / VLR

**PCU** : Packet Control Unit，负责移动分组数据的组装和拆解

**GPRS** : General Packet Radio Service

**PDN** : Packet Data Network



# 七、新一代交换控制技术

## NGN

![image-20210620144531336](https://gitee.com/cmz2000/album/raw/master/image/image-20210620144531336.png)

